----------------------------------------------------------------------------------------
PCIe (Peripheral Component Interconnect express)

PCI Express Topology:

                +-----+
                | CPU |
                +-----+
                   |
   +--------------------------------+      +--------+
   |         root complex           | <--> | memory |
   +--------------------------------+      +--------+
        |              |            |
   +--------+  +---------------+  +--------------+
   | switch |  | PCIe endpoint |  | PCIe bridge  |
   +--------+  +---------------+  | to PCI/PCI-X |
        |                         +--------------+
   +-------------------+
   | PCIe endpoint x N |
   +-------------------+

----------------------------------------------------------------------------------------
PCI vs. PCIe

PCI uses a shared parallel bus architecture, in which the PCI host and all devices share
a common set of address, data, and control lines.

PCI Express is based on point-to-point topology, with separate serial links connecting
every devices to the root complex (host).

PCI Express bus link supports full-duplex communication between any two endpoints, with
no inherent limitation on concurrent access across multiple endpoints.

A connection between any two PCIe devices is known as a link, and is built up from a
collection of one or more lanes.

PCI Express is a layered protocol.

1) Physical layer (PHY, PCIe PHY)
* logical sublayer
   |
   |___ MAC
   |
   |___ PCS

* electrical sublayer

----------------------------------------------------------------------------------------
Data Transmission

PCIe sends all control messages, including interrupts, over the same links used for data. 

Data link layer services:

* Sequence the transaction layer packets (TLPs) that are generated by the transaction
layer.

* Ensure reliable delivery of TLPs between two endpoints via an acknowledgement protocol
(ACK and NAK signaling) that explicitly requires replay of unacknowledgement/bad TLPs.

* Initialize and manage flow control credits.

    +--------------------------------+
    | Transaction Layer Packet (TLP) |
    +--------------------------------+
    | Header | Data Payload | ECRC   |
    +--------------------------------+
                    |
    +--------------------------------+
    |          Link Packet           |
    +--------------------------------+
    | Sequence |   TLP   |   LCRC    |
    +--------------------------------+
                    |
    +--------------------------------+
    |        Physical Packet         |
    +--------------------------------+
    | Start | Link Packet |  End     |
    +--------------------------------+
                    |
                    | Encode
                    *
----------------------------------------------------------------------------------------
